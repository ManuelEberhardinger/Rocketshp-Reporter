<h1><%= get_header(@status) %></h1>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Name</th>
      <th>Lead source</th>
      <th>Job types</th>
      <th>Website</th>
      <th>Monthly total</th>
      <th>Anual value</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @companies.each do |company| %>
    <tr>
      <td><%= company.name %></td>
      <td><%= company.lead_source %></td>
      <td><%= company.job_types %></td>
      <td><%= link_to company.website, company.website, target: 'blank' %></td>
      <td>$<%= company.monthly_total.to_i %></td>
      <td>$<%= company.monthly_total.to_i * 12%></td>
      <td><%= link_to 'Show', company %></td>
      <td><%= link_to 'Edit', edit_company_path(company), remote: true %></td>
      <% if current_user.admin? %>
      <td><%= link_to 'Destroy', company, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      <% end %>
    </tr>
    <% end %>
  </tbody>
</table>
<%= link_to 'New Company', new_company_path, remote: true %>

<div class="row vertical-align">
  <div class="col-sm-4">
    <h3>Lead Source</h3>
    <%= pie_chart @companies.group(:lead_source).count %>
  </div>
  <div class="col-sm-4">
    <h3>Job Types</h3>
    <%= pie_chart @companies.group(:job_types).count %>
  </div>
  <div class="col-sm-4">
    <%= ('<h3>Monthly Income: $' + sum_up_monthly_total(@companies).to_s + '</h3>').html_safe %>
    <%= ('<h3>Annual Revenue: $' + (sum_up_monthly_total(@companies) * 12).to_s + '</h3>').html_safe %>
    <% if @status.nil? %>
    <%= ('<h3>Pipeline: $' + sum_up_monthly_total(@pipeline).to_s + '</h3>').html_safe %>
    <% end %>
  </div>
</div>
<br>
