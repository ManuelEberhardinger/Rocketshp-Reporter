<% if @show_lost %>
<h1>Lost Companies</h1>
<% else %>
<h1>Listing Companies</h1>
<% end %>

<% if notice %>
<div class="alert alert-info">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <p><%= notice %></p>
</div>
<% end %>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Lead source</th>
      <th>Job types</th>
      <th>Website</th>
      <th>Monthly total</th>
      <th>Anual value</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @companies.where(lost: @show_lost).each do |company| %>
    <tr>
      <td><%= company.name %></td>
      <td><%= company.description %></td>
      <td><%= company.lead_source %></td>
      <td><%= company.job_types %></td>
      <td><%= link_to company.website, company.website, target: 'blank' %></td>
      <td>$<%= company.monthly_total.to_i %></td>
      <td>$<%= company.monthly_total.to_i * 12%></td>
      <td><%= link_to 'Show', company %></td>
      <td><%= link_to 'Edit', edit_company_path(company) %></td>
      <% if current_user.admin? %>
      <td><%= link_to 'Destroy', company, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      <% end %>
    </tr>
    <% end %>
  </tbody>
</table>
<%= link_to 'New Company', new_company_path %>

<div class="row vertical-align">
  <div class="col-sm-4">
    <h3>Lead Source</h3>
    <%= pie_chart @companies.where(lost: @show_lost).group(:lead_source).count %>
  </div>
  <div class="col-sm-4">
    <h3>Job Types</h3>
    <%= pie_chart @companies.where(lost: @show_lost).group(:job_types).count %>
  </div>
  <div class="col-sm-4">
    <%= ('<h3>Total Pipeline: $' + sum_up_monthly_total(@companies.where(lost: @show_lost)).to_s + '</h3>').html_safe %>
    <%= ('<h3>Annual Revenue: $' + (sum_up_monthly_total(@companies.where(lost: @show_lost)) * 12).to_s + '</h3>').html_safe %>
  </div>
</div>

<br>
